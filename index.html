<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>SHEFO Store | Live</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700;900&display=swap" rel="stylesheet">

<style>
/* --- Ø§Ù„ØªØµÙ…ÙŠÙ… --- */
:root { --bg-main: #020617; --bg-surface: #0f172a; --primary: #d97706; --primary-glow: #fbbf24; --text: #f1f5f9; --border: #1e293b; --success: #10b981; --danger: #ef4444; }
* {box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent;}
body { margin: 0; font-family: 'Tajawal', sans-serif; background: var(--bg-main); color: var(--text); padding-bottom: 0; overflow-x: hidden; }

/* Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
.splash-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; transition: opacity 0.5s ease-out; }
.splash-logo { font-size: 3rem; font-weight: 900; background: linear-gradient(45deg, var(--primary), var(--primary-glow)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: pulseLogo 1.5s infinite alternate; }
.loader-bar { width: 150px; height: 4px; background: #1e293b; margin-top: 20px; border-radius: 2px; overflow: hidden; }
.loader-progress { width: 0%; height: 100%; background: var(--primary); animation: loadProgress 2s ease-in-out forwards; }
@keyframes pulseLogo { from{transform:scale(1); opacity:0.8;} to{transform:scale(1.1); opacity:1;} }
@keyframes loadProgress { 0%{width:0%} 100%{width:100%} }

/* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ù…ØªØ­Ø±Ùƒ */
.top-ticker { background: linear-gradient(90deg, #b45309, #d97706); color: white; font-size: 0.85rem; padding: 6px 0; overflow: hidden; white-space: nowrap; }
.ticker-text { display: inline-block; animation: scrollText 20s linear infinite; padding-left: 100%; font-weight: bold; }
@keyframes scrollText { 0% { transform: translateX(0); } 100% { transform: translateX(100%); } }

/* Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ */
.flash-sale-box { background: rgba(255,255,255,0.05); border: 1px solid var(--primary); border-radius: 15px; padding: 15px; margin: 15px auto; display: inline-block; min-width: 250px; }
.flash-title { color: var(--danger); font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }
.timer-display { font-family: monospace; font-size: 1.5rem; color: white; letter-spacing: 2px; background: #000; padding: 5px 15px; border-radius: 8px; }

header { background: rgba(2, 6, 23, 0.95); backdrop-filter: blur(15px); padding: 10px 20px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
.brand { font-size: 1.6rem; font-weight: 900; background: linear-gradient(45deg, var(--primary), var(--primary-glow)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; user-select: none; }
.glow-icons { display: flex; gap: 12px; background: rgba(255, 255, 255, 0.05); padding: 6px 12px; border-radius: 30px; border: 1px solid rgba(255, 255, 255, 0.1); }
.glow-icons a { text-decoration: none; font-size: 1.3rem; transition: 0.3s; display:flex; }
.fa-whatsapp { color: #25D366; } .fa-facebook { color: #1877F2; } .fa-instagram { color: #E1306C; }
.cart-btn { position: relative; color: white; font-size: 1.5rem; cursor: pointer; }
.badge { position: absolute; top: -5px; right: -8px; background: var(--primary); color: black; font-weight: bold; font-size: 0.7rem; padding: 2px 6px; border-radius: 10px; }

.hero { text-align: center; padding: 40px 20px; background: radial-gradient(circle at top, #1e293b 0%, var(--bg-main) 70%); }
.hero h2 { font-size: 2rem; margin: 0 0 10px; color: white; }
.search-container { margin: 20px; position: relative; }
.search-input { width: 100%; padding: 15px 50px 15px 20px; background: var(--bg-surface); border: 1px solid var(--border); border-radius: 30px; color: white; font-size: 1rem; }
.search-icon { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: #64748b; }

.nav-scroller { display: flex; gap: 10px; overflow-x: auto; padding: 0 15px 20px; scrollbar-width: none; }
.nav-item { background: var(--bg-surface); color: #94a3b8; border: 1px solid var(--border); padding: 10px 25px; border-radius: 50px; white-space: nowrap; cursor: pointer; transition: 0.3s; }
.nav-item.active { background: var(--primary); color: black; font-weight: bold; }

#products { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 20px; padding: 15px; }
.card { background: var(--bg-surface); border-radius: 15px; border: 1px solid var(--border); overflow: hidden; position: relative; transition: 0.3s; display: flex; flex-direction: column; }
.card img { width: 100%; height: 250px; object-fit: contain; background: #fff; padding: 10px; border-bottom: 1px solid var(--border); }
.card-content { padding: 15px; background: linear-gradient(to bottom, var(--bg-surface), #0b1221); }
.stock-warning { color: var(--danger); font-size: 0.8rem; font-weight: bold; animation: pulse-red 1.5s infinite; display: block; margin-top: 5px; }
.stock-normal { color: var(--success); font-size: 0.8rem; font-weight: bold; display: block; margin-top: 5px; }
@keyframes pulse-red { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

.price-row { display: flex; justify-content: space-between; margin-top: 10px; align-items: center; }
.price { font-size: 1.2rem; font-weight: bold; }
.add-btn { background: var(--primary); border: none; width: 35px; height: 35px; border-radius: 10px; cursor: pointer; }

.checkout-box { margin: 30px 15px; padding: 25px; border-radius: 25px; background: #1e293b; border: 1px solid var(--border); }
.custom-input { width: 100%; padding: 15px; background: var(--bg-main); border: 1px solid var(--border); border-radius: 12px; color: white; margin-bottom: 12px; }
.btn-main { width: 100%; padding: 15px; border-radius: 12px; background: linear-gradient(135deg, var(--primary), #b45309); color: white; font-weight: bold; border: none; cursor: pointer; }

footer { text-align: center; padding: 40px 20px; background: #000; margin-top: 50px; border-top: 1px solid var(--border); }
.developer-credit { margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1); font-size: 0.9rem; color: #94a3b8; }
.dev-name { color: var(--primary-glow); font-weight: bold; text-decoration: none; }

.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; place-items: center; z-index: 200; }
.modal-content { background: var(--bg-surface); width: 95%; max-width: 500px; padding: 25px; border-radius: 20px; border: 1px solid var(--border); max-height: 90vh; overflow-y: auto; }
.admin-item { display: flex; justify-content: space-between; align-items: center; background: var(--bg-main); padding: 10px; margin-bottom: 8px; border-radius: 8px; border: 1px solid var(--border); }
.admin-item img { width: 40px; height: 40px; border-radius: 5px; object-fit: cover; }
</style>
</head>
<body>

<div class="splash-screen" id="splash">
    <div class="splash-logo">SHEFO</div>
    <div class="loader-bar"><div class="loader-progress"></div></div>
</div>

<div class="top-ticker"><div class="ticker-text" id="tickerText">loading...</div></div>

<header>
    <div class="brand" onclick="triggerSecret()">SHEFO</div>
    <div class="glow-icons">
        <a href="https://wa.me/201070411245" target="_blank"><i class="fab fa-whatsapp"></i></a>
        <a href="https://www.facebook.com/share/1DYwnY6RxZ/" target="_blank"><i class="fab fa-facebook"></i></a>
        <a href="https://www.instagram.com/shefo_1k" target="_blank"><i class="fab fa-instagram"></i></a>
    </div>
    <div class="cart-btn" onclick="scrollToCheckout()">
        <i class="fas fa-shopping-bag"></i> <span class="badge" id="cartCount">0</span>
    </div>
</header>

<div class="hero">
    <h2>âœ¨ SHEFO STORE</h2>
    
    <div class="flash-sale-box">
        <div class="flash-title">ğŸ”¥ Ø§Ù„Ø¹Ø±Ø¶ ÙŠÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„:</div>
        <div class="timer-display" id="countdown">--:--:--</div>
    </div>

    <div class="search-container">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="searchInp" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
    </div>
</div>

<nav class="nav-scroller" id="catNav">
    <button class="nav-item active" onclick="filterCat('all', this)">Ø§Ù„ÙƒÙ„</button>
    <button class="nav-item" onclick="filterCat('Ø³Ø§Ø¹Ø§Øª Ø±Ø¬Ø§Ù„ÙŠ', this)">Ø³Ø§Ø¹Ø§Øª Ø±Ø¬Ø§Ù„ÙŠ</button>
    <button class="nav-item" onclick="filterCat('Ø³Ø§Ø¹Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ', this)">Ø³Ø§Ø¹Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ</button>
    <button class="nav-item" onclick="filterCat('Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø±Ø¬Ø§Ù„ÙŠ', this)">Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø±Ø¬Ø§Ù„ÙŠ</button>
    <button class="nav-item" onclick="filterCat('Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ', this)">Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ</button>
    <button class="nav-item" onclick="filterCat('Ø´Ø±Ø¨Ø§Øª', this)">Ø´Ø±Ø¨Ø§Øª</button>
    <button class="nav-item" onclick="filterCat('Ø¨ÙˆÙƒØ³Ø±Ø§Øª', this)">Ø¨ÙˆÙƒØ³Ø±Ø§Øª</button>
    <button class="nav-item" onclick="filterCat('Ø¨Ø±ÙØ§Ù† Ø±Ø¬Ø§Ù„ÙŠ', this)">Ø¨Ø±ÙØ§Ù† Ø±Ø¬Ø§Ù„ÙŠ</button>
    <button class="nav-item" onclick="filterCat('Ø¨Ø±ÙØ§Ù† Ø­Ø±ÙŠÙ…ÙŠ', this)">Ø¨Ø±ÙØ§Ù† Ø­Ø±ÙŠÙ…ÙŠ</button>
    <button class="nav-item" onclick="filterCat('ÙƒØ§Ø¨', this)">ÙƒØ§Ø¨</button>
    <button class="nav-item" onclick="filterCat('Ø´Ù†Ø· Ø­Ø±ÙŠÙ…ÙŠ', this)">Ø´Ù†Ø· Ø­Ø±ÙŠÙ…ÙŠ</button>
    <button class="nav-item" onclick="filterCat('Ø£Ø­Ø²Ù…Ø©', this)">Ø£Ø­Ø²Ù…Ø©</button>
</nav>

<main id="products"></main>

<div class="checkout-box" id="checkoutSection">
    <h3 style="color:var(--primary); margin-bottom:20px">ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
    <div id="cartItems" style="margin-bottom:20px; color:#aaa; font-size:0.9rem">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>
    <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom:15px">
        <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span> <span id="totalPrice" style="color:var(--primary)">0 Ø¬.Ù…</span>
    </div>
    
    <input id="cName" class="custom-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">
    <input id="cPhone" type="tel" class="custom-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
    <input id="cAddress" class="custom-input" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„">
    <button id="sendOrderBtn" class="btn-main"><i class="fab fa-whatsapp"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
</div>

<footer>
    <h2 style="color:white; margin:0">SHEFO</h2>
    <div class="developer-credit">
        Developed by <a href="https://wa.me/201033186744" target="_blank" class="dev-name">Ziad Hany</a>
        <div style="margin-top:5px; font-size:1.2rem">
            <a href="https://wa.me/201033186744" target="_blank" style="color:#25D366; margin:0 5px"><i class="fab fa-whatsapp"></i></a>
            <a href="https://www.facebook.com/share/1ARKH2JF8i/" target="_blank" style="color:#1877F2; margin:0 5px"><i class="fab fa-facebook"></i></a>
        </div>
    </div>
</footer>

<div class="modal" id="passModal">
    <div class="modal-content" style="text-align:center">
        <h3>ğŸ” Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
        <input type="password" id="passInp" class="custom-input" placeholder="Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯">
        <button id="loginBtn" class="btn-main">Ø¯Ø®ÙˆÙ„</button>
        <button onclick="document.getElementById('passModal').style.display='none'" style="background:none; border:none; color:red; margin-top:10px">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div class="modal" id="dashModal">
    <div class="modal-content">
        <h3 style="text-align:center; color:var(--primary)">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
        
        <div style="display:flex; gap:10px; margin-bottom:15px">
            <button onclick="switchTab('add')" class="btn-main" style="padding:10px; font-size:0.8rem">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
            <button onclick="switchTab('edit')" class="btn-main" style="padding:10px; font-size:0.8rem">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
            <button onclick="switchTab('settings')" class="btn-main" style="padding:10px; font-size:0.8rem">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>

        <div id="view-add">
            <input id="nPName" class="custom-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            <input type="file" id="nPFile" class="custom-input" accept="image/*">
            <input id="nPPrice" type="number" class="custom-input" placeholder="Ø§Ù„Ø³Ø¹Ø±">
            <input id="nPQty" type="number" class="custom-input" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
            <select id="nPCat" class="custom-input">
                <option value="Ø³Ø§Ø¹Ø§Øª Ø±Ø¬Ø§Ù„ÙŠ">Ø³Ø§Ø¹Ø§Øª Ø±Ø¬Ø§Ù„ÙŠ</option>
                <option value="Ø³Ø§Ø¹Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ">Ø³Ø§Ø¹Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ</option>
                <option value="Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø±Ø¬Ø§Ù„ÙŠ">Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø±Ø¬Ø§Ù„ÙŠ</option>
                <option value="Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ">Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ</option>
                <option value="Ø´Ø±Ø¨Ø§Øª">Ø´Ø±Ø¨Ø§Øª</option>
                <option value="Ø¨ÙˆÙƒØ³Ø±Ø§Øª">Ø¨ÙˆÙƒØ³Ø±Ø§Øª</option>
                <option value="Ø¨Ø±ÙØ§Ù† Ø±Ø¬Ø§Ù„ÙŠ">Ø¨Ø±ÙØ§Ù† Ø±Ø¬Ø§Ù„ÙŠ</option>
                <option value="Ø¨Ø±ÙØ§Ù† Ø­Ø±ÙŠÙ…ÙŠ">Ø¨Ø±ÙØ§Ù† Ø­Ø±ÙŠÙ…ÙŠ</option>
                <option value="ÙƒØ§Ø¨">ÙƒØ§Ø¨</option>
                <option value="Ø´Ù†Ø· Ø­Ø±ÙŠÙ…ÙŠ">Ø´Ù†Ø· Ø­Ø±ÙŠÙ…ÙŠ</option>
                <option value="Ø£Ø­Ø²Ù…Ø©">Ø£Ø­Ø²Ù…Ø©</option>
            </select>
            <button id="addProdBtn" class="btn-main" style="background:var(--success)">Ù†Ø´Ø±</button>
        </div>

        <div id="view-edit" style="display:none">
            <div id="adminList"></div>
        </div>

        <div id="view-settings" style="display:none">
            <label style="color:white; margin-bottom:5px; display:block">Ù†Øµ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ù…ØªØ­Ø±Ùƒ:</label>
            <input id="nTicker" class="custom-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§">
            
            <label style="color:white; margin-bottom:5px; display:block; margin-top:10px">Ù…Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ (Ø¨Ø§Ù„Ø³Ø§Ø¹Ø§Øª):</label>
            <input id="nTimer" type="number" class="custom-input" placeholder="4">

            <button id="saveConfigBtn" class="btn-main" style="margin-top:10px">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>

        <button onclick="location.reload()" style="width:100%; margin-top:20px; background:#ef4444; border:none; padding:15px; color:white; border-radius:10px">Ø®Ø±ÙˆØ¬ ÙˆØªØ­Ø¯ÙŠØ«</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, updateDoc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // ğŸ”´ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ
    const firebaseConfig = {
      apiKey: "AIzaSyCdsXCuOtmne7g5oytUtOTZpOFgNEcoChA",
      authDomain: "shefo-store-e21df.firebaseapp.com",
      projectId: "shefo-store-e21df",
      storageBucket: "shefo-store-e21df.firebasestorage.app",
      messagingSenderId: "115869788089",
      appId: "1:115869788089:web:dee7128b974d310abab868"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const productsColl = collection(db, "products");
    const settingsDoc = doc(db, "settings", "mainConfig");

    let allProducts = [];
    let cart = [];
    let currentCat = "all";
    let timerInterval;

    // --- Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ø§Ù…Ø© ---
    window.scrollToCheckout = () => {
        document.getElementById('checkoutSection').scrollIntoView({behavior:'smooth'});
    };

    let clicks = 0;
    window.triggerSecret = () => {
        clicks++;
        if(clicks === 5) {
            document.getElementById('passModal').style.display = 'flex';
            clicks = 0;
        }
        setTimeout(() => clicks = 0, 1000);
    };

    window.filterCat = (cat, btn) => {
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentCat = cat;
        renderProducts();
    };

    window.switchTab = (tab) => {
        document.getElementById('view-add').style.display = tab==='add'?'block':'none';
        document.getElementById('view-edit').style.display = tab==='edit'?'block':'none';
        document.getElementById('view-settings').style.display = tab==='settings'?'block':'none';
        if(tab==='edit') renderAdminList();
    };

    // --- Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ---
    window.onload = async () => {
        setTimeout(() => { 
            document.getElementById('splash').style.opacity = '0'; 
            setTimeout(()=>document.getElementById('splash').style.display='none', 500); 
        }, 2000);
        loadSettings();
        await fetchProducts();
    };

    // --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ù„Ø´Ø±ÙŠØ·) ---
    async function loadSettings() {
        try {
            const docSnap = await getDoc(settingsDoc);
            if (docSnap.exists()) {
                const data = docSnap.data();
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ·
                document.getElementById('tickerText').innerText = data.ticker || "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø´ÙŠÙÙˆ Ø³ØªÙˆØ±";
                document.getElementById('nTicker').value = data.ticker || "";
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
                let hours = data.timerHours || 4;
                document.getElementById('nTimer').value = hours;
                startTimer(hours);
            } else {
                await setDoc(settingsDoc, { ticker: "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø´ÙŠÙÙˆ Ø³ØªÙˆØ±", timerHours: 4 });
                startTimer(4);
            }
        } catch(e) { console.log("Config not found yet"); }
    }

    function startTimer(hours) {
        if(timerInterval) clearInterval(timerInterval);
        let duration = hours * 60 * 60;
        
        timerInterval = setInterval(() => {
            let h = Math.floor(duration / 3600);
            let m = Math.floor((duration % 3600) / 60);
            let s = duration % 60;
            
            document.getElementById('countdown').innerText = 
                `${h < 10 ? "0"+h : h}:${m < 10 ? "0"+m : m}:${s < 10 ? "0"+s : s}`;
            
            if (--duration < 0) duration = hours * 60 * 60;
        }, 1000);
    }

    document.getElementById('saveConfigBtn').addEventListener('click', async () => {
        const text = document.getElementById('nTicker').value;
        const time = document.getElementById('nTimer').value;
        
        await setDoc(settingsDoc, { ticker: text, timerHours: time });
        alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª! Ù‡ÙŠØ¸Ù‡Ø±ÙˆØ§ Ù„Ù„Ù†Ø§Ø³ ÙÙˆØ±Ø§Ù‹ âœ…");
        location.reload();
    });

    // --- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ---
    async function fetchProducts() {
        try {
            const querySnapshot = await getDocs(productsColl);
            allProducts = [];
            querySnapshot.forEach((doc) => {
                allProducts.push({ id: doc.id, ...doc.data() });
            });
            renderProducts();
        } catch(e) {
            console.error(e);
            alert("ÙÙŠ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");
        }
    }

    function renderProducts() {
        const container = document.getElementById('products');
        container.innerHTML = "";
        
        const filtered = currentCat === "all" ? allProducts : allProducts.filter(p => p.cat === currentCat);

        if(filtered.length === 0) {
            container.innerHTML = "<p style='color:#888; text-align:center; grid-column:1/-1'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>";
            return;
        }

        filtered.forEach(p => {
            let stockHtml = `<span class="stock-normal">Ù…ØªØ§Ø­: ${p.qty} Ù‚Ø·Ø¹Ø©</span>`;
            let btnState = "";
            
            if(p.qty <= 0) {
                stockHtml = `<span class="stock-warning" style="text-decoration:line-through; color:#888">Ù†ÙØ¯Øª Ø§Ù„ÙƒÙ…ÙŠØ© âŒ</span>`;
                btnState = "disabled style='background:#333; cursor:not-allowed'";
            } else if (p.qty <= 2) {
                stockHtml = `<span class="stock-warning">ğŸ”¥ Ù…ØªØ¨Ù‚ÙŠ ${p.qty} ÙÙ‚Ø·!</span>`;
            }

            const div = document.createElement('div');
            div.className = "card";
            div.innerHTML = `
                <img src="${p.img}" alt="${p.name}">
                <div class="card-content">
                    <span style="font-size:0.7rem; color:#fbbf24; text-transform:uppercase">${p.cat}</span>
                    <h4 style="margin:5px 0; color:white">${p.name}</h4>
                    ${stockHtml}
                    <div class="price-row">
                        <span class="price">${p.price} Ø¬.Ù…</span>
                        <button class="add-btn" ${btnState} data-id="${p.id}"><i class="fas fa-plus"></i></button>
                    </div>
                </div>
            `;
            div.querySelector('.add-btn').addEventListener('click', () => {
                if(p.qty > 0) addToCart(p);
            });
            container.appendChild(div);
        });
    }

    function addToCart(product) {
        cart.push(product);
        updateCartUI();
        alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© âœ…");
    }

    function updateCartUI() {
        document.getElementById('cartCount').innerText = cart.length;
        const list = document.getElementById('cartItems');
        list.innerHTML = "";
        let total = 0;
        
        if(cart.length === 0) list.innerHTML = "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©";
        
        cart.forEach((p) => {
            total += parseInt(p.price);
            list.innerHTML += `
            <div class="cart-item" style="display:flex; justify-content:space-between; margin-bottom:5px; border-bottom:1px solid #333; padding:5px">
                <span>${p.name}</span>
                <span>${p.price}</span>
            </div>`;
        });
        document.getElementById('totalPrice').innerText = total + " Ø¬.Ù…";
    }

    document.getElementById('sendOrderBtn').addEventListener('click', () => {
        if(cart.length === 0) return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
        let name = document.getElementById('cName').value;
        let phone = document.getElementById('cPhone').value;
        let addr = document.getElementById('cAddress').value;
        if(!name || !phone) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ ÙˆØ±Ù‚Ù…Ùƒ");

        let items = cart.map(p => `- ${p.name} (${p.price}Ø¬)`).join("%0a");
        let total = document.getElementById('totalPrice').innerText;
        let msg = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹* ğŸš€%0aØ§Ø³Ù…: ${name}%0aØ±Ù‚Ù…: ${phone}%0aØ¹Ù†ÙˆØ§Ù†: ${addr}%0a---------------%0a${items}%0a---------------%0aØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total}`;
        
        window.open(`https://wa.me/201070411245?text=${msg}`);
        cart = []; updateCartUI();
    });

    document.getElementById('searchInp').addEventListener('keyup', (e) => {
        let term = e.target.value.toLowerCase();
        document.querySelectorAll('.card').forEach(c => {
            let name = c.querySelector('h4').innerText.toLowerCase();
            c.style.display = name.includes(term) ? "flex" : "none";
        });
    });

    // --- Ø§Ù„Ø¯Ø§Ø´ Ø¨ÙˆØ±Ø¯ ---
    document.getElementById('loginBtn').addEventListener('click', () => {
        if(document.getElementById('passInp').value === "ziad1234") {
            document.getElementById('passModal').style.display = 'none';
            document.getElementById('dashModal').style.display = 'flex';
            renderAdminList();
        } else {
            alert("Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ØºÙ„Ø·");
        }
    });

    document.getElementById('addProdBtn').addEventListener('click', async () => {
        const name = document.getElementById('nPName').value;
        const price = document.getElementById('nPPrice').value;
        const cat = document.getElementById('nPCat').value;
        const qty = document.getElementById('nPQty').value;
        const file = document.getElementById('nPFile').files[0];

        if(!name || !price || !qty) return alert("ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        document.getElementById('addProdBtn').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...";

        let imgUrl = "https://via.placeholder.com/300";
        if(file) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                imgUrl = reader.result;
                await saveToDb(name, price, cat, qty, imgUrl);
            }
        } else {
            await saveToDb(name, price, cat, qty, imgUrl);
        }
    });

    async function saveToDb(name, price, cat, qty, img) {
        try {
            await addDoc(productsColl, { name, price, cat, qty, img });
            alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            document.getElementById('addProdBtn').innerText = "Ù†Ø´Ø±";
            fetchProducts();
        } catch(e) {
            console.error(e);
            alert("Ø­ØµÙ„ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„");
        }
    }

    function renderAdminList() {
        const list = document.getElementById('adminList');
        list.innerHTML = "";
        
        if(allProducts.length === 0) list.innerHTML = "<p style='text-align:center; color:#888'>Ù…ÙÙŠØ´ Ù…Ù†ØªØ¬Ø§Øª</p>";

        allProducts.forEach(p => {
            const item = document.createElement('div');
            item.className = "admin-item";
            item.innerHTML = `
                <div style="display:flex;align-items:center;gap:10px">
                    <img src="${p.img}">
                    <div>${p.name}</div>
                </div>
                <div style="display:flex;gap:5px">
                    <input type="number" value="${p.qty}" style="width:50px;background:#000;color:white;border:1px solid #333;text-align:center" class="qty-edit">
                    <button class="save-qty-btn" style="background:green;border:none;color:white;cursor:pointer;padding:5px;border-radius:4px"><i class="fas fa-save"></i></button>
                    <button class="del-btn" style="background:red;border:none;color:white;cursor:pointer;padding:5px;border-radius:4px"><i class="fas fa-trash"></i></button>
                </div>
            `;
            
            item.querySelector('.del-btn').addEventListener('click', async () => {
                if(confirm("Ù…Ø³Ø­ØŸ")) {
                    await deleteDoc(doc(db, "products", p.id));
                    fetchProducts();
                    setTimeout(() => renderAdminList(), 1000);
                }
            });

            item.querySelector('.save-qty-btn').addEventListener('click', async () => {
                const newQty = item.querySelector('.qty-edit').value;
                await updateDoc(doc(db, "products", p.id), { qty: newQty });
                alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø¯");
                fetchProducts();
            });

            list.appendChild(item);
        });
    }
</script>
</body>
</html>
